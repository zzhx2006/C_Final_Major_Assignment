digraph {
graph [splines=polyline];
D0 [shape=box, style=rounded, label="begin"];
{rank = sink; D1 [shape=box, style=rounded, label="end"];}
D4 [shape=box, label="thread_args *t = (thread_args *)arg;"];
D6 [shape=box, label="prtlog(\"执行 receive_from_client(). \");"];
D8 [shape=box, label="prtlog(\"client_fd = %d\", client_fd);"];
D10 [shape=box, label="memset(received_message, 0, kStringLength);"];
D12 [shape=box, label="bool is_name = 1;"];
D16 [shape=diamond, label="(t->client_fd > 0 && client_count < kMaxClientCount)?"];
D19 [shape=box, label="int ret = recv(t->client_fd, received_message, sizeof(received_message), 0);"];
D21 [shape=box, label="prtlog(\"recv()已经被执行. \");"];
D23 [shape=diamond, label="(ret < 0)?"];
D28 [shape=box, label="prterr(recv());"];
D30 [shape=box, label="close(t->client_fd);"];
D32 [shape=box, label="free(t);"];
D34 [shape=box, label="return NULL;"];
D36 [shape=diamond, label="(ret == 0)?"];
D41 [shape=box, label="disconnect_client(t->client_fd);"];
D43 [shape=box, label="free(t);"];
D45 [shape=box, label="return NULL;"];
D47 [shape=box, label="prtlog(\"\033[32m成功接收一条来自客户端 %d 的消息: \033[0m%s\", t->client_fd, received_message);"];
D49 [shape=diamond, label="(is_name)?"];
D54 [shape=box, label="strcpy(client_list[get_client_by_fd(t->client_fd)].name, received_message);"];
D56 [shape=box, label="is_name = 0;"];
D58 [shape=box, label="prtlog(\"该客户端的昵称设置为 %s\", received_message);"];
D60 [shape=box, label="const char msg[kStringLength] = \" 进入了聊天室. \";"];
D62 [shape=box, label="strcat(received_message, msg);"];
D64 [shape=box, label="forward_all_client(-1, received_message);"];
D68 [shape=box, label="prtlog(\"尝试群发这条消息. \");"];
D70 [shape=diamond, label="(forward_all_client(get_client_by_fd(t->client_fd), received_message) < 0)?"];
D75 [shape=box, label="prtlog(\"\033[31m群发消息时发生异常. \033[0m\");"];
D77 [shape=box, label="prtlog(\"\033[32m群发成功. \033[0m\");"];
D79 [shape=box, label="free(t);"];
D81 [shape=box, label="return NULL;"];
D4 -> D6;
D6 -> D8;
D8 -> D10;
D10 -> D12;
D16:e -> D79:n [xlabel=N];
D12 -> D19;
D19 -> D21;
D21 -> D23;
D36:e -> D47:n [xlabel=N];
D28 -> D30;
D30 -> D32;
D32 -> D34;
D23:e -> D36:n [xlabel=N];
D34 -> D1;
D41 -> D43;
D36:s -> D41:n [xlabel=Y];
D43 -> D45;
D47 -> D49;
D45 -> D1;
D23:s -> D28:n [xlabel=Y];
D54 -> D56;
D56 -> D58;
D58 -> D60;
D60 -> D62;
D62 -> D64;
D64 -> D16;
D68 -> D70;
D49:s -> D54:n [xlabel=Y];
D49:e -> D68:n [xlabel=N];
D70:e -> D77:n [xlabel=N];
D75 -> D77;
D77 -> D16;
D70:s -> D75:n [xlabel=Y];
D79 -> D81;
D16:s -> D19:n [xlabel=Y];
D81 -> D1;
D0 -> D4;
}
